(()=>{"use strict";var e={n:s=>{var t=s&&s.__esModule?()=>s.default:()=>s;return e.d(t,{a:t}),t},d:(s,t)=>{for(var a in t)e.o(t,a)&&!e.o(s,a)&&Object.defineProperty(s,a,{enumerable:!0,get:t[a]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};(()=>{const s=window.jQuery;var t=e.n(s);const a=window.wp.a11y;!function(e,s,t){const o=e("#changelog-contents"),r=e("#rollback-action"),l=e("#rollback-action .spinner"),n=e("#rollback-action .button-text"),u=r.data("rollback_text"),d=r.data("rolling_back_text"),c=e("#rollback-cancel"),i=e("#show-changelog");s.updates.requestForCredentialsModalClose=function(){e("#request-filesystem-credentials-dialog").hide(),e("body").removeClass("modal-open"),s.updates.$elToReturnFocusToFromCredentialsModal&&s.updates.$elToReturnFocusToFromCredentialsModal.trigger("focus"),s.updates.ajaxLocked||s.updates.rollbackButtonReset()},s.updates.credentialError=function(e,t){const a=s.updates._addCallbacks({error:s.updates.rollbackPluginError,plugin:e.plugin,slug:e.slug,success:s.updates.rollbackPluginSuccess,targetVersion:e.targetVersion},t);s.updates.queue.unshift({action:t,data:a}),s.updates.filesystemCredentials.available=!1,s.updates.showErrorInCredentialsForm(e.message),s.updates.requestFilesystemCredentials()},s.updates.isValidResponse=function(e){if(e.error&&"unable_to_connect_to_filesystem"===e.errorCode)return e.message,!0;if(!1===e.error)return!0;const t=e.message;return s.updates.addAdminNotice({id:"rollback_error",className:"notice-error is-dismissible",message:_.escape(t)}),s.updates.ajaxLocked=!1,s.updates.queue=[],(0,a.speak)(t,"assertive"),!1},s.updates.rollbackPluginSuccess=function(t){const o=t.message;(0,a.speak)(_.escape(o)),s.updates.addAdminNotice({id:"rollback_success",className:"notice-success is-dismissible",message:_.escape(o)}),s.updates.rollbackButtonReset(),e(document).trigger("wp-plugin-rollback-success",t)},s.updates.rollbackPluginError=function(t){s.updates.isValidResponse(t)?s.updates.maybeHandleCredentialError(t,"rollback-plugin")?s.updates.rollbackButtonStart():(s.updates.rollbackButtonReset(),e(document).trigger("wp-plugin-rollback-error",t)):s.updates.rollbackButtonReset()},s.updates.queueChecker=function(){if(s.updates.ajaxLocked||!s.updates.queue.length)return;const e=s.updates.queue.shift();"rollback-plugin"===e.action&&s.updates.rollbackPlugin(e.data)},s.updates.ajax=function(t,a){const o={};return s.updates.ajaxLocked?(s.updates.queue.push({action:t,data:a}),e.Deferred()):(s.updates.ajaxLocked=!0,a.success&&(o.success=a.success,delete a.success),a.error&&(o.error=a.error,delete a.error),o.data=_.extend(a,{action:"storepress_plugin_rollback",_ajax_nonce:s.updates.ajaxNonce,_fs_nonce:s.updates.filesystemCredentials.fsNonce,username:s.updates.filesystemCredentials.ftp.username,password:s.updates.filesystemCredentials.ftp.password,hostname:s.updates.filesystemCredentials.ftp.hostname,connection_type:s.updates.filesystemCredentials.ftp.connectionType,public_key:s.updates.filesystemCredentials.ssh.publicKey,private_key:s.updates.filesystemCredentials.ssh.privateKey}),s.ajax.send(o).always(s.updates.ajaxAlways))},s.updates.rollbackPlugin=function(t){return t=_.extend({success:s.updates.rollbackPluginSuccess,error:s.updates.rollbackPluginError},t),e(document).trigger("wp-plugin-doing-rollback",t),s.updates.rollbackButtonStart(),s.updates.ajax("rollback-plugin",t)},s.updates.rollbackButtonStart=function(){n.text(d),r.addClass("button-disabled"),c.addClass("button-disabled"),l.addClass("is-active")},s.updates.rollbackButtonReset=function(){n.text(u),r.removeClass("button-disabled"),c.removeClass("button-disabled"),l.removeClass("is-active")},e((function(){i.on("click",(s=>{o.get(0).showModal(),e("body").addClass("modal-open")})),o.on("click",(s=>{s.target===o.get(0)&&(o.get(0).close(),e("body").removeClass("modal-open"))})),r.on("click",(a=>{a.preventDefault(),s.updates.maybeRequestFilesystemCredentials(a);const o=e(".available-versions:checked").val(),r={plugin:t.plugin,slug:t.slug,targetVersion:o};s.updates.rollbackPlugin(r)}))}))}(t(),window.wp,window.StorePressPluginRollbackStrings)})()})();