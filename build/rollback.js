(()=>{"use strict";var e={n:s=>{var t=s&&s.__esModule?()=>s.default:()=>s;return e.d(t,{a:t}),t},d:(s,t)=>{for(var a in t)e.o(t,a)&&!e.o(s,a)&&Object.defineProperty(s,a,{enumerable:!0,get:t[a]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};(()=>{const s=window.jQuery;var t=e.n(s);const a=window.wp.a11y;!function(e,s,t,r){const o=e("#changelog-contents"),l=e("#rollback-action"),n=e("#rollback-action .spinner"),u=e("#rollback-action .button-text"),d=l.data("rollback_text"),c=l.data("rolling_back_text"),i=e("#rollback-cancel"),p=e("#show-changelog");t.updates.rollbackVersionUpdate=function({versionID:s,targetVersion:t}){e(`#version-id-${s}`).append(e("#version-list-current-mark")),e("#rollback-current-version").text(t)},t.updates.requestForCredentialsModalClose=function(){e("#request-filesystem-credentials-dialog").hide(),e("body").removeClass("modal-open"),t.updates.$elToReturnFocusToFromCredentialsModal&&t.updates.$elToReturnFocusToFromCredentialsModal.trigger("focus"),t.updates.ajaxLocked||t.updates.rollbackButtonReset()},t.updates.credentialError=function(e,s){const a=t.updates._addCallbacks({error:t.updates.rollbackPluginError,plugin:e.plugin,slug:e.slug,success:t.updates.rollbackPluginSuccess,targetVersion:e.targetVersion},s);t.updates.queue.unshift({action:s,data:a}),t.updates.filesystemCredentials.available=!1,t.updates.showErrorInCredentialsForm(e.message),t.updates.requestFilesystemCredentials()},t.updates.isValidResponse=function(e){if(e.error&&"unable_to_connect_to_filesystem"===e.errorCode)return!0;if(!1===e.error)return!0;const r=e.message;return t.updates.addAdminNotice({id:"rollback_error",className:"notice-error is-dismissible",message:s.escape(r)}),t.updates.ajaxLocked=!1,t.updates.queue=[],(0,a.speak)(r,"assertive"),!1},t.updates.rollbackPluginSuccess=function(r){const o=r.message;(0,a.speak)(s.escape(o)),t.updates.addAdminNotice({id:"rollback_success",className:"notice-success is-dismissible",message:s.escape(o)}),t.updates.rollbackButtonReset(),t.updates.rollbackVersionUpdate(r),e(document).trigger("wp-plugin-rollback-success",r)},t.updates.rollbackPluginError=function(s){t.updates.isValidResponse(s)?t.updates.maybeHandleCredentialError(s,"rollback-plugin")?t.updates.rollbackButtonStart():(t.updates.rollbackButtonReset(),e(document).trigger("wp-plugin-rollback-error",s)):t.updates.rollbackButtonReset()},t.updates.queueChecker=function(){if(t.updates.ajaxLocked||!t.updates.queue.length)return;const e=t.updates.queue.shift();"rollback-plugin"===e.action&&t.updates.rollbackPlugin(e.data)},t.updates.ajax=function(a,r){const o={};return t.updates.ajaxLocked?(t.updates.queue.push({action:a,data:r}),e.Deferred()):(t.updates.ajaxLocked=!0,r.success&&(o.success=r.success,delete r.success),r.error&&(o.error=r.error,delete r.error),o.data=s.extend(r,{action:"storepress_plugin_rollback",_ajax_nonce:t.updates.ajaxNonce,_fs_nonce:t.updates.filesystemCredentials.fsNonce,username:t.updates.filesystemCredentials.ftp.username,password:t.updates.filesystemCredentials.ftp.password,hostname:t.updates.filesystemCredentials.ftp.hostname,connection_type:t.updates.filesystemCredentials.ftp.connectionType,public_key:t.updates.filesystemCredentials.ssh.publicKey,private_key:t.updates.filesystemCredentials.ssh.privateKey}),t.ajax.send(o).always(t.updates.ajaxAlways))},t.updates.rollbackPlugin=function(a){return a=s.extend({success:t.updates.rollbackPluginSuccess,error:t.updates.rollbackPluginError},a),e(document).trigger("wp-plugin-doing-rollback",a),t.updates.rollbackButtonStart(),t.updates.ajax("rollback-plugin",a)},t.updates.rollbackButtonStart=function(){u.text(c),l.addClass("button-disabled"),i.addClass("button-disabled"),n.addClass("is-active")},t.updates.rollbackButtonReset=function(){u.text(d),l.removeClass("button-disabled"),i.removeClass("button-disabled"),n.removeClass("is-active")},e((function(){p.on("click",(()=>{o.get(0).showModal(),e("body").addClass("modal-open")})),o.on("click",(s=>{s.target===o.get(0)&&(o.get(0).close(),e("body").removeClass("modal-open"))})),l.on("click",(s=>{s.preventDefault(),t.updates.maybeRequestFilesystemCredentials(s);const a=e(".available-versions:checked").val(),o={plugin:r.plugin,slug:r.slug,targetVersion:a};t.updates.rollbackPlugin(o)}))}))}(t(),window._,window.wp,window.StorePressPluginRollbackStrings)})()})();