(()=>{"use strict";(()=>{const e=window.StorePress.Utils,t=(0,e.createStorePressPlugin)({selector:"[data-storepress-conditional-field]",options:{},plugin:function(t,s){const n={},i={COMPARE_OPERATOR:{KEY:"compare",DEFAULT:"EQ",AVAILABLE:{EQ:["EQUAL","=","EQ","SAME"],GT:["GREATER THAN",">","GT"],LT:["LESS THAN","<","LT"],GTEQ:["GREATER THAN OR EQUAL",">=","GTEQ"],LTEQ:["LESS THAN OR EQUAL","<=","LTEQ"],INCLUDES:["HAS","INCLUDES","CONTAINS","IN","LIKE"]}},TYPE_OPERATOR:{KEY:"type",DEFAULT:"BOOLEAN",AVAILABLE:["STRING","STRING-ARRAY","NUMBER","NUMBER-ARRAY","BOOLEAN","RANGE","MINMAX","ELEMENT","REGEXP"]},FUNCTIONS_FOR_TYPE:{BOOLEAN:"EXISTS",STRING:"STRING","STRING-ARRAY":"STRING-ARRAY",NUMBER:"NUMBER","NUMBER-ARRAY":"NUMBER-ARRAY",ELEMENT:"ELEMENT",MINMAX:"MINMAX",RANGE:"RANGE",REGEXP:"REGEXP"},RELATION_OPERATOR:{DEFAULT:"AND",KEY:"relation",AVAILABLE:["AND","OR"]},SELECTOR_OPERATOR:{KEY:"selector"},VALUE_OPERATOR:{KEY:"value",DEFAULT:!0},INERT_OPERATOR:{KEY:"inert",DEFAULT:!1},STRICT_OPERATOR:{KEY:"strict",DEFAULT:!1},CASE_SENSITIVITY_OPERATOR:{KEY:"case",DEFAULT:!1},ELEMENT_CHECK_FN:{KEY:"check",DEFAULT:"STRING",AVAILABLE:["STRING","STRING-ARRAY","NUMBER","NUMBER-ARRAY","RANGE","MINMAX","VISIBLE"]},REQUIRE_OPERATOR:{KEY:"require",DEFAULT:!1},FN_OPERATOR:{KEY:"fn"},EVENTS:["input"]},E={relation:i.RELATION_OPERATOR.DEFAULT},r=e=>i.FUNCTIONS_FOR_TYPE[e],o=()=>i.CASE_SENSITIVITY_OPERATOR.KEY,l=()=>i.ELEMENT_CHECK_FN.KEY,c=()=>i.FN_OPERATOR.KEY,A=()=>i.VALUE_OPERATOR.KEY,u=()=>i.REQUIRE_OPERATOR.KEY,a=()=>i.TYPE_OPERATOR.KEY,R=()=>i.INERT_OPERATOR.KEY,h=()=>i.STRICT_OPERATOR.KEY,p=()=>i.COMPARE_OPERATOR.KEY,d=e=>e[u()],T=(e,t)=>{e[u()]=t},N=(e,t)=>{e[c()]=t},m=e=>e[i.SELECTOR_OPERATOR.KEY],O=e=>e[o()],g=e=>e[l()],S=e=>e[A()],y=e=>e[a()],L=(e,t)=>{e[a()]=t},I=e=>e[R()],f=(e,t)=>{e[R()]=t},v=e=>{const t=e[p()];return Object.keys(i.COMPARE_OPERATOR.AVAILABLE).find(e=>i.COMPARE_OPERATOR.AVAILABLE[e].includes(t))},U=e=>e[h()],P=e=>e.type.toUpperCase(),M=(e,t)=>{const s=[],n=[];let i=0;const E=[],r=t.split(","),o=[],l=new Set,c=new Set;return e.forEach(t=>{const A=P(t),u=t.name,a=r.find(e=>t.matches(e));if("SELECT-MULTIPLE"===A){const e=Array.from(t.selectedOptions).filter(e=>e.value.length>0).map(e=>e.value);n.push(...e),s.push(`INPUT:${A}`),E.push(e.length>0),i+=e.length,o.push({input:e,length:e.length,multiple:!0,type:A,selector:t})}if("CHECKBOX"===A&&!c.has(a)){s.push(`INPUT:${A}`);const r=Array.from(e).filter(e=>e.matches(a)&&"CHECKBOX"===P(e)).filter(e=>e.checked&&e.value.length>0).map(e=>e.value);n.push(...r),E.push(r.length>0),i+=r.length,o.push({input:r,length:r.length,multiple:!0,type:A,selector:t}),c.add(a)}if("RADIO"===A&&!l.has(u)){s.push(`INPUT:${A}`);const r=Array.from(e).filter(e=>e.name===u&&"RADIO"===P(e)).find(e=>e.checked&&e.value.length>0),c=r?r.value:"";n.push(c),E.push(c.length>0),i+=c.length,o.push({input:c.length>0?[c]:[],length:c.length,multiple:!1,type:A,selector:t}),l.add(u)}if(!["SELECT-MULTIPLE","CHECKBOX","RADIO"].includes(A)){s.push(`INPUT:${A}`);const e=t.value.length>0?t.value:"";n.push(e),E.push(e.length>0),i+=e.length,o.push({input:e.length>0?[e]:[],length:e.length,multiple:!1,type:A,selector:t})}}),{inputs:s,values:n,count:i,empty:!E.every(e=>e),notEmpty:E.every(e=>e),map:o}},_=(e,t,s=!1,n=!1)=>{if(s)return n?e.toString().includes(t):e.includes(t);const i=RegExp.escape(t),E=n?new RegExp(`\\b${i}\\b`,"ui"):new RegExp(`^${i}$`,"ui");return e.some(e=>E.test(e))},F=(e,t,s=!1,n=!1)=>!(!Array.isArray(e)||!Array.isArray(t))&&(s?n?t.every(t=>e.includes(t)):e.every(e=>t.includes(e)):n?t.every(t=>{const s=RegExp.escape(t),n=new RegExp(`\\b${s}\\b`,"ui");return e.some(e=>n.test(e))}):e.every(e=>{const s=RegExp.escape(e),n=new RegExp(`^${s}$`,"ui");return t.some(e=>n.test(e))})),b=(e,t,s=!1,n=!1)=>!(!Array.isArray(e)||!Array.isArray(t))&&(s?n?t.some(t=>e.includes(t)):e.some(e=>t.includes(e)):n?t.some(t=>{const s=RegExp.escape(t),n=new RegExp(`\\b${s}\\b`,"ui");return e.some(e=>n.test(e))}):e.some(e=>{const s=RegExp.escape(e),n=new RegExp(`^${s}$`,"ui");return t.some(e=>n.test(e))})),w={EXISTS:e=>{this.showField=I(e);const t=m(e),s=document.querySelectorAll(t),{notEmpty:n}=M(s,t);n&&(this.showField=!I(e))},STRING:e=>{this.showField=I(e);const t=S(e),s=U(e),n=O(e),i=m(e),E=document.querySelectorAll(i),{notEmpty:r,map:o}=M(E,i),l="INCLUDES"===v(e);r&&o.every(({input:e,multiple:i,length:E})=>i?((e,t,s,n,i,E)=>n?1===t&&((e,t,s=!1,n=!1)=>{if(s)return n?e.toString().includes(t):e.includes(t);const i=RegExp.escape(t),E=n?new RegExp(`\\b${i}\\b`,"ui"):new RegExp(`^${i}$`,"ui");return e.every(e=>E.test(e))})(e,s,i,E):_(e,s,i,E))(e,E,t,s,n,l):_(e,t,n,l))&&(this.showField=!I(e))},NUMBER:e=>{this.showField=I(e);const t=Number(S(e)),s=v(e),n=m(e),i=document.querySelectorAll(n),{notEmpty:E,map:r}=M(i,n);E&&r.every(({length:e})=>"EQ"===s&&e===t||"GT"===s&&e>t||"GTEQ"===s&&e>=t||"LT"===s&&e<t||"LTEQ"===s&&e<=t)&&(this.showField=!I(e))},"STRING-ARRAY":e=>{this.showField=I(e);const t=S(e),s=U(e),n=d(e),i=O(e),E=m(e),r=document.querySelectorAll(E),o="INCLUDES"===v(e),{notEmpty:l,map:c}=M(r,E);if(l){const E=c.every(({input:e,multiple:E})=>E?((e,t,s,n,i,E)=>s?e.length===t.length&&F(t,e,i,E):n?F(t,e,i,E):b(t,e,i,E))(e,t,s,n,i,o):b(e,t,i,o));E&&(this.showField=!I(e))}},"NUMBER-ARRAY":e=>{this.showField=I(e);const t=S(e),s=m(e),n=document.querySelectorAll(s),{notEmpty:i,map:E}=M(n,s);i&&E.every(({length:e})=>t.includes(e))&&(this.showField=!I(e))},MINMAX:e=>{this.showField=I(e);const t=S(e),[s=0,n=Number.MAX_SAFE_INTEGER]=t,i=m(e),E=document.querySelectorAll(i),{notEmpty:r,map:o}=M(E,i);r&&o.every(({length:e})=>s<=e&&n>=e)&&(this.showField=!I(e))},RANGE:e=>{this.showField=I(e);const t=S(e),s=m(e),n=document.querySelectorAll(s),[i=0,E=Number.MAX_SAFE_INTEGER]=t,{notEmpty:r,map:o}=M(n,s);r&&o.every(({input:e,selector:t})=>["RANGE","NUMBER"].includes(P(t))&&i<=Number(e.at(0))&&E>=Number(e.at(0)))&&(this.showField=!I(e))},REGEXP:e=>{this.showField=I(e);const t=S(e),s=m(e),n=document.querySelectorAll(s),{notEmpty:i,map:E}=M(n,s),r=(e=>{const[t,s,n]=e.match(/^\/(.+)\/([gimsuyx]*)$/);return{pattern:s,flags:n,_:t}})(t),o=U(e);i&&E.every(({input:e,multiple:t})=>t?o?e.every(e=>new RegExp(r.pattern,r.flags).test(e)):e.some(e=>new RegExp(r.pattern,r.flags).test(e)):e.every(e=>new RegExp(r.pattern,r.flags).test(e)))&&(this.showField=!I(e))},VISIBLE:e=>{this.showField=I(e);const t=U(e),s=S(e),n=document.querySelectorAll(s),i=[];n.forEach(e=>{i.push(e.checkVisibility())}),t&&i.every(e=>e)&&(this.showField=!I(e)),!t&&i.some(e=>e)&&(this.showField=!I(e))},ELEMENT:e=>{const t=g(e);if(!i.ELEMENT_CHECK_FN.AVAILABLE.includes(t))return;if(["VISIBLE"].includes(t)){const s={...e};return void w[`${t}`](s)}const s=S(e),n=document.querySelectorAll(s),{map:E}=M(n,s),r=E.some(({multiple:e})=>!0===e)||E.length>1,o=r?E.reduce((e,{input:s,length:n})=>(["RANGE","MINMAX"].includes(t)?e.push(...s.map(e=>Number(e))):"NUMBER"===t?e.push(n):e.push(...s),e),[]):E.reduce((e,{input:s,length:n,type:i})=>{const E=s.at(0);return"NUMBER"===t?["NUMBER","RANGE"].includes(i)?E??0:n:E??""},""),l=["STRING","NUMBER"].includes(t)&&r?"-ARRAY":"",c={...e,[A()]:o};w[`${t}${l}`](c)}},C=(e=!0)=>{!0===e?this.$element.setAttribute("inert",""):this.$element.removeAttribute("inert")},Y=(e,t)=>{const s=(e=>e[c()])(e);if("function"!=typeof w[s])throw new Error('Compare function "'+s+'" not available.');w[s](e,t),this.matched.set(e.selector,this.showField),"AND"===this.relation&&([...this.matched.values()].every(e=>!0===e)?C(!1):C(!0)),"OR"===this.relation&&([...this.matched.values()].some(e=>!0===e)?C(!1):C(!0))},G=()=>{C(!0),this.showField=!1,this.conditions=[],this.matched=new Map,this.controller.abort()},B=e=>{if(delete e[c()],void 0===v(e)&&((e,t)=>{e[p()]=t})(e,i.COMPARE_OPERATOR.DEFAULT),void 0===g(e)&&((e,t)=>{e[l()]=t})(e,i.ELEMENT_CHECK_FN.DEFAULT),void 0===U(e)&&((e,t)=>{e[h()]=t})(e,i.STRICT_OPERATOR.DEFAULT),void 0===d(e)&&T(e,i.REQUIRE_OPERATOR.DEFAULT),!0===U(e)&&T(e,!1),void 0===O(e)&&((e,t)=>{e[o()]=t})(e,i.CASE_SENSITIVITY_OPERATOR.DEFAULT),void 0===I(e)&&f(e,i.INERT_OPERATOR.DEFAULT),void 0===y(e)&&L(e,i.TYPE_OPERATOR.DEFAULT),void 0===S(e)&&((e,t)=>{e[A()]=t})(e,i.VALUE_OPERATOR.DEFAULT),"boolean"==typeof S(e)&&(L(e,"BOOLEAN"),!1===S(e)&&f(e,!0),N(e,r(y(e)))),"string"==typeof S(e)&&(["ELEMENT"].includes(y(e))||L(e,"STRING"),N(e,r(y(e)))),"number"==typeof S(e)&&(L(e,"NUMBER"),N(e,r(y(e)))),(e=>"object"==typeof e[A()]&&Array.isArray(e[A()]))(e)){if(["ELEMENT"].includes(y(e)))return["MINMAX","RANGE"].includes(g(e))?N(e,"NUMBER-ARRAY"):N(e,"STRING-ARRAY"),e;S(e).every(e=>"number"==typeof e)?(["MINMAX","RANGE"].includes(y(e))||L(e,"NUMBER-ARRAY"),N(e,r(y(e)))):(L(e,"STRING-ARRAY"),N(e,r(y(e))))}var t;return"string"==typeof(t=S(e))&&new RegExp("/(.+)/([gimsuyx]*)").test(t)&&(L(e,"REGEXP"),N(e,r(y(e)))),e},D=()=>{for(const e in this.settings)if(!isNaN(e)){const t=this.settings[e];this.conditions.push(B(t))}if(this.conditions.length<1){const e=this.settings;this.conditions.push(B(e))}},K=()=>this.conditions,$=()=>{const e=K();e.forEach(e=>{this.matched.set(e.selector,!1)}),e.forEach(e=>{if("ELEMENT"===y(e)){const t=S(e),s=document.querySelectorAll(t);s.forEach(t=>{i.EVENTS.forEach(n=>{t.addEventListener(n,()=>{Y(e,s)},{signal:this.signal,passive:!0})}),Y(e,s)})}const t=m(e),s=document.querySelectorAll(t);s.forEach(t=>{i.EVENTS.forEach(n=>{t.addEventListener(n,()=>{Y(e,s)},{signal:this.signal,passive:!0})}),Y(e,s)}),this.$parent.length>0&&this.$parent.addEventListener("reset",((e,t)=>()=>{setTimeout(()=>{Y(e,t)},1)})(e,s),{signal:this.signal,passive:!0})})};return(()=>(this.$element=t,this.settings={...E,...s,...(0,e.getOptionsFromAttribute)(this.$element,"storepress-conditional-field",{parseNumber:!1,parseBoolean:!1,parseRegex:!1}),...n},this.relation=this.settings.relation,this.showField=!1,this.conditions=[],this.$parent=this.$element.closest("form"),this.matched=new Map,this.controller=new AbortController,this.signal=this.controller.signal,D(),$(),{reset:G}))()},namespace:"Conditional"});t.setup();const s=t;!function(e,t){const n={Init({slug:n,dialog:i,_ajax_nonce:E,action:r}){const o=document.querySelector(`a#deactivate-${n}`);o.addEventListener("click",n=>{n.preventDefault();const l=o.getAttribute("href"),c=new AbortController;s.init(),StorePress.AdminDialog({selector:i,onOpen(e,t){e.querySelector(".skip-deactivate").setAttribute("href",l),e.querySelectorAll('form input[type="radio"]').forEach(e=>{e.addEventListener("input",e=>{const s=e.currentTarget.closest("li").querySelector(".input-field");s?(s.value.length>0?t.forEach(e=>{e.removeAttribute("disabled")}):t.forEach(e=>{e.setAttribute("disabled",!0)}),s.addEventListener("input",e=>{e.currentTarget.value.length>0?t.forEach(e=>{e.removeAttribute("disabled")}):t.forEach(e=>{e.setAttribute("disabled",!0)})})):t.forEach(e=>{e.removeAttribute("disabled")})},{signal:c.signal,passive:!0})})},onClose(e,t){e.querySelector("form").reset(),c.abort(),s.destroy(),t.forEach(e=>{e.querySelector(".button-text").textContent=e.dataset.label,e.querySelector(".spinner").classList.remove("is-active"),e.setAttribute("disabled",!0)})},onSubmit(s,n){n.forEach(e=>{e.querySelector(".button-text").textContent=e.dataset.processing,e.querySelector(".spinner").classList.add("is-active"),e.setAttribute("disabled",!0)});const i=s.querySelector("form input:checked"),o=i.value,c=i?.closest("li").querySelector(".input-field")?.value,A={reason_type:o,reason_value:null!=c?c:""};t.ajax.post(r,{_ajax_nonce:E,data:A}).always(function(){s.close(),e.location.replace(l)})}})})}};e.StorePress=e.StorePress||{},e.StorePress.AdminPluginDeactivationFeedback=n.Init}(window,wp)})()})();