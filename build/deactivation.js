(()=>{"use strict";(()=>{const e=window.StorePress.Utils,t=(0,e.createStorePressPlugin)({selector:"[data-storepress-conditional-field]",options:{},plugin:function(t,s){const n={},i={COMPARE_OPERATOR:{KEY:"compare",DEFAULT:"EQ",AVAILABLE:{EQ:["EQUAL","=","EQ","SAME"],GT:["GREATER THAN",">","GT"],LT:["LESS THAN","<","LT"],GTEQ:["GREATER THAN OR EQUAL",">=","GTEQ"],LTEQ:["LESS THAN OR EQUAL","<=","LTEQ"],INCLUDES:["HAS","INCLUDES","CONTAINS","IN","LIKE"]}},TYPE_OPERATOR:{KEY:"type",DEFAULT:"BOOLEAN",AVAILABLE:["STRING","STRING-ARRAY","NUMBER","NUMBER-ARRAY","BOOLEAN","RANGE","MINMAX","ELEMENT","REGEXP"]},FUNCTIONS_FOR_TYPE:{BOOLEAN:"EXISTS",STRING:"STRING","STRING-ARRAY":"STRING-ARRAY",NUMBER:"NUMBER","NUMBER-ARRAY":"NUMBER-ARRAY",ELEMENT:"ELEMENT",MINMAX:"MINMAX",RANGE:"RANGE",REGEXP:"REGEXP"},RELATION_OPERATOR:{DEFAULT:"AND",KEY:"relation",AVAILABLE:["AND","OR"]},SELECTOR_OPERATOR:{KEY:"selector"},VALUE_OPERATOR:{KEY:"value",DEFAULT:!0},INERT_OPERATOR:{KEY:"inert",DEFAULT:!1},STRICT_OPERATOR:{KEY:"strict",DEFAULT:!1},CASE_SENSITIVITY_OPERATOR:{KEY:"case",DEFAULT:!1},ELEMENT_CHECK_FN:{KEY:"check",DEFAULT:"STRING",AVAILABLE:["STRING","STRING-ARRAY","NUMBER","NUMBER-ARRAY","RANGE","MINMAX","VISIBLE"]},REQUIRE_OPERATOR:{KEY:"require",DEFAULT:!1},FN_OPERATOR:{KEY:"fn"},EVENTS:["input"]},r={relation:i.RELATION_OPERATOR.DEFAULT,disableInertInput:!0,readOnlyInertInput:!1,inertInput:"input, select, textarea"},E=e=>i.FUNCTIONS_FOR_TYPE[e],o=()=>i.CASE_SENSITIVITY_OPERATOR.KEY,l=()=>i.ELEMENT_CHECK_FN.KEY,c=()=>i.FN_OPERATOR.KEY,a=()=>i.VALUE_OPERATOR.KEY,u=()=>i.REQUIRE_OPERATOR.KEY,A=()=>i.TYPE_OPERATOR.KEY,R=()=>i.INERT_OPERATOR.KEY,h=()=>i.STRICT_OPERATOR.KEY,p=()=>i.COMPARE_OPERATOR.KEY,d=e=>e[u()],T=(e,t)=>{e[u()]=t},N=(e,t)=>{e[c()]=t},m=e=>e[i.SELECTOR_OPERATOR.KEY],O=e=>e[o()],g=e=>e[l()],I=e=>e[a()],y=e=>e[A()],S=(e,t)=>{e[A()]=t},L=e=>e[R()],f=(e,t)=>{e[R()]=t},v=e=>{const t=e[p()];return Object.keys(i.COMPARE_OPERATOR.AVAILABLE).find(e=>i.COMPARE_OPERATOR.AVAILABLE[e].includes(t))},U=e=>e[h()],P=e=>e.type.toUpperCase(),M=(e,t)=>{const s=[],n=[];let i=0;const r=[],E=t.split(","),o=[],l=new Set,c=new Set;return e.forEach(t=>{const a=P(t),u=t.name,A=E.find(e=>t.matches(e));if("SELECT-MULTIPLE"===a){const e=Array.from(t.selectedOptions).filter(e=>e.value.length>0).map(e=>e.value);n.push(...e),s.push(`INPUT:${a}`),r.push(e.length>0),i+=e.length,o.push({input:e,length:e.length,multiple:!0,type:a,selector:t})}if("CHECKBOX"===a&&!c.has(A)){s.push(`INPUT:${a}`);const E=Array.from(e).filter(e=>e.matches(A)&&"CHECKBOX"===P(e)).filter(e=>e.checked&&e.value.length>0).map(e=>e.value);n.push(...E),r.push(E.length>0),i+=E.length,o.push({input:E,length:E.length,multiple:!0,type:a,selector:t}),c.add(A)}if("RADIO"===a&&!l.has(u)){s.push(`INPUT:${a}`);const E=Array.from(e).filter(e=>e.name===u&&"RADIO"===P(e)).find(e=>e.checked&&e.value.length>0),c=E?E.value:"";n.push(c),r.push(c.length>0),i+=c.length,o.push({input:c.length>0?[c]:[],length:c.length,multiple:!1,type:a,selector:t}),l.add(u)}if(!["SELECT-MULTIPLE","CHECKBOX","RADIO"].includes(a)){s.push(`INPUT:${a}`);const e=t.value.length>0?t.value:"";n.push(e),r.push(e.length>0),i+=e.length,o.push({input:e.length>0?[e]:[],length:e.length,multiple:!1,type:a,selector:t})}}),{inputs:s,values:n,count:i,empty:!r.every(e=>e),notEmpty:r.every(e=>e),map:o}},b=(e,t,s=!1,n=!1)=>{if(s)return n?e.toString().includes(t):e.includes(t);const i=RegExp.escape(t),r=n?new RegExp(`\\b${i}\\b`,"ui"):new RegExp(`^${i}$`,"ui");return e.some(e=>r.test(e))},_=(e,t,s=!1,n=!1)=>!(!Array.isArray(e)||!Array.isArray(t))&&(s?n?t.every(t=>e.includes(t)):e.every(e=>t.includes(e)):n?t.every(t=>{const s=RegExp.escape(t),n=new RegExp(`\\b${s}\\b`,"ui");return e.some(e=>n.test(e))}):e.every(e=>{const s=RegExp.escape(e),n=new RegExp(`^${s}$`,"ui");return t.some(e=>n.test(e))})),F=(e,t,s=!1,n=!1)=>!(!Array.isArray(e)||!Array.isArray(t))&&(s?n?t.some(t=>e.includes(t)):e.some(e=>t.includes(e)):n?t.some(t=>{const s=RegExp.escape(t),n=new RegExp(`\\b${s}\\b`,"ui");return e.some(e=>n.test(e))}):e.some(e=>{const s=RegExp.escape(e),n=new RegExp(`^${s}$`,"ui");return t.some(e=>n.test(e))})),w={EXISTS:e=>{this.showField=L(e);const t=m(e),s=document.querySelectorAll(t),{notEmpty:n}=M(s,t);n&&(this.showField=!L(e))},STRING:e=>{this.showField=L(e);const t=I(e),s=U(e),n=O(e),i=m(e),r=document.querySelectorAll(i),{notEmpty:E,map:o}=M(r,i),l="INCLUDES"===v(e);E&&o.every(({input:e,multiple:i,length:r})=>i?((e,t,s,n,i,r)=>n?1===t&&((e,t,s=!1,n=!1)=>{if(s)return n?e.toString().includes(t):e.includes(t);const i=RegExp.escape(t),r=n?new RegExp(`\\b${i}\\b`,"ui"):new RegExp(`^${i}$`,"ui");return e.every(e=>r.test(e))})(e,s,i,r):b(e,s,i,r))(e,r,t,s,n,l):b(e,t,n,l))&&(this.showField=!L(e))},NUMBER:e=>{this.showField=L(e);const t=Number(I(e)),s=v(e),n=m(e),i=document.querySelectorAll(n),{notEmpty:r,map:E}=M(i,n);r&&E.every(({length:e})=>"EQ"===s&&e===t||"GT"===s&&e>t||"GTEQ"===s&&e>=t||"LT"===s&&e<t||"LTEQ"===s&&e<=t)&&(this.showField=!L(e))},"STRING-ARRAY":e=>{this.showField=L(e);const t=I(e),s=U(e),n=d(e),i=O(e),r=m(e),E=document.querySelectorAll(r),o="INCLUDES"===v(e),{notEmpty:l,map:c}=M(E,r);if(l){const r=c.every(({input:e,multiple:r})=>r?((e,t,s,n,i,r)=>s?e.length===t.length&&_(t,e,i,r):n?_(t,e,i,r):F(t,e,i,r))(e,t,s,n,i,o):F(e,t,i,o));r&&(this.showField=!L(e))}},"NUMBER-ARRAY":e=>{this.showField=L(e);const t=I(e),s=m(e),n=document.querySelectorAll(s),{notEmpty:i,map:r}=M(n,s);i&&r.every(({length:e})=>t.includes(e))&&(this.showField=!L(e))},MINMAX:e=>{this.showField=L(e);const t=I(e),[s=0,n=Number.MAX_SAFE_INTEGER]=t,i=m(e),r=document.querySelectorAll(i),{notEmpty:E,map:o}=M(r,i);E&&o.every(({length:e})=>s<=e&&n>=e)&&(this.showField=!L(e))},RANGE:e=>{this.showField=L(e);const t=I(e),s=m(e),n=document.querySelectorAll(s),[i=0,r=Number.MAX_SAFE_INTEGER]=t,{notEmpty:E,map:o}=M(n,s);E&&o.every(({input:e,selector:t})=>["RANGE","NUMBER"].includes(P(t))&&i<=Number(e.at(0))&&r>=Number(e.at(0)))&&(this.showField=!L(e))},REGEXP:e=>{this.showField=L(e);const t=I(e),s=m(e),n=document.querySelectorAll(s),{notEmpty:i,map:r}=M(n,s),E=(e=>{const[t,s,n]=e.match(/^\/(.+)\/([gimsuyx]*)$/);return{pattern:s,flags:n,_:t}})(t),o=U(e);i&&r.every(({input:e,multiple:t})=>t?o?e.every(e=>new RegExp(E.pattern,E.flags).test(e)):e.some(e=>new RegExp(E.pattern,E.flags).test(e)):e.every(e=>new RegExp(E.pattern,E.flags).test(e)))&&(this.showField=!L(e))},VISIBLE:e=>{this.showField=L(e);const t=U(e),s=I(e),n=document.querySelectorAll(s),i=[];n.forEach(e=>{i.push(e.checkVisibility())}),t&&i.every(e=>e)&&(this.showField=!L(e)),!t&&i.some(e=>e)&&(this.showField=!L(e))},ELEMENT:e=>{const t=g(e);if(!i.ELEMENT_CHECK_FN.AVAILABLE.includes(t))return;if(["VISIBLE"].includes(t)){const s={...e};return void w[`${t}`](s)}const s=I(e),n=document.querySelectorAll(s),{map:r}=M(n,s),E=r.some(({multiple:e})=>!0===e)||r.length>1,o=E?r.reduce((e,{input:s,length:n})=>(["RANGE","MINMAX"].includes(t)?e.push(...s.map(e=>Number(e))):"NUMBER"===t?e.push(n):e.push(...s),e),[]):r.reduce((e,{input:s,length:n,type:i})=>{const r=s.at(0);return"NUMBER"===t?["NUMBER","RANGE"].includes(i)?r??0:n:r??""},""),l=["STRING","NUMBER"].includes(t)&&E?"-ARRAY":"",c={...e,[a()]:o};w[`${t}${l}`](c)}},Y=(e=!0)=>{const t=this.$element.querySelectorAll(this.settings.inertInput);!0===e?(this.$element.setAttribute("inert",""),this.settings.disableInertInput&&t.forEach(e=>e.disabled=!0),this.settings.readOnlyInertInput&&t.forEach(e=>e.readOnly=!0)):(this.$element.removeAttribute("inert"),this.settings.disableInertInput&&t.forEach(e=>e.disabled=!1),this.settings.readOnlyInertInput&&t.forEach(e=>e.readOnly=!1))},C=(e,t)=>{const s=(e=>e[c()])(e);if("function"!=typeof w[s])throw new Error('Compare function "'+s+'" not available.');w[s](e,t),this.matched.set(e.selector,this.showField),"AND"===this.relation&&([...this.matched.values()].every(e=>!0===e)?Y(!1):Y(!0)),"OR"===this.relation&&([...this.matched.values()].some(e=>!0===e)?Y(!1):Y(!0))},G=()=>{Y(!0),this.showField=!1,this.conditions=[],this.matched=new Map,this.controller.abort()},B=e=>{if(delete e[c()],void 0===v(e)&&((e,t)=>{e[p()]=t})(e,i.COMPARE_OPERATOR.DEFAULT),void 0===g(e)&&((e,t)=>{e[l()]=t})(e,i.ELEMENT_CHECK_FN.DEFAULT),void 0===U(e)&&((e,t)=>{e[h()]=t})(e,i.STRICT_OPERATOR.DEFAULT),void 0===d(e)&&T(e,i.REQUIRE_OPERATOR.DEFAULT),!0===U(e)&&T(e,!1),void 0===O(e)&&((e,t)=>{e[o()]=t})(e,i.CASE_SENSITIVITY_OPERATOR.DEFAULT),void 0===L(e)&&f(e,i.INERT_OPERATOR.DEFAULT),void 0===y(e)&&S(e,i.TYPE_OPERATOR.DEFAULT),void 0===I(e)&&((e,t)=>{e[a()]=t})(e,i.VALUE_OPERATOR.DEFAULT),"boolean"==typeof I(e)&&(S(e,"BOOLEAN"),!1===I(e)&&f(e,!0),N(e,E(y(e)))),"string"==typeof I(e)&&(["ELEMENT"].includes(y(e))||S(e,"STRING"),N(e,E(y(e)))),"number"==typeof I(e)&&(S(e,"NUMBER"),N(e,E(y(e)))),(e=>"object"==typeof e[a()]&&Array.isArray(e[a()]))(e)){if(["ELEMENT"].includes(y(e)))return["MINMAX","RANGE"].includes(g(e))?N(e,"NUMBER-ARRAY"):N(e,"STRING-ARRAY"),e;I(e).every(e=>"number"==typeof e)?(["MINMAX","RANGE"].includes(y(e))||S(e,"NUMBER-ARRAY"),N(e,E(y(e)))):(S(e,"STRING-ARRAY"),N(e,E(y(e))))}var t;return"string"==typeof(t=I(e))&&new RegExp("/(.+)/([gimsuyx]*)").test(t)&&(S(e,"REGEXP"),N(e,E(y(e)))),e},D=()=>{for(const e in this.settings)if(!isNaN(e)){const t=this.settings[e];this.conditions.push(B(t))}if(this.conditions.length<1){const e=this.settings;this.conditions.push(B(e))}},$=()=>this.conditions,x=()=>{const e=$();e.forEach(e=>{this.matched.set(e.selector,!1)}),e.forEach(e=>{if("ELEMENT"===y(e)){const t=I(e),s=document.querySelectorAll(t);s.forEach(t=>{i.EVENTS.forEach(n=>{t.addEventListener(n,()=>{C(e,s)},{signal:this.signal,passive:!0})}),C(e,s)})}const t=m(e),s=document.querySelectorAll(t);s.forEach(t=>{i.EVENTS.forEach(n=>{t.addEventListener(n,()=>{C(e,s)},{signal:this.signal,passive:!0})}),C(e,s)}),this.$parent.length>0&&this.$parent.addEventListener("reset",((e,t)=>()=>{setTimeout(()=>{C(e,t)},1)})(e,s),{signal:this.signal,passive:!0})})};return(()=>(this.$element=t,this.settings={...r,...s,...(0,e.getOptionsFromAttribute)(this.$element,"storepress-conditional-field",{parseNumber:!1,parseBoolean:!1,parseRegex:!1}),...n},this.relation=this.settings.relation,this.showField=!1,this.conditions=[],this.$parent=this.$element.closest("form"),this.matched=new Map,this.controller=new AbortController,this.signal=this.controller.signal,D(),x(),{reset:G}))()},namespace:"conditional"});t.setup();const s=t;!function(e,t){const n={Init({slug:n,dialog:i,_ajax_nonce:r,action:E}){const o=document.querySelector(`a#deactivate-${n}`);o.addEventListener("click",n=>{n.preventDefault();const l=o.getAttribute("href"),c=new AbortController;s.init(),StorePress.AdminDialog({selector:i,onOpen(e,t){e.querySelector(".skip-deactivate").setAttribute("href",l),e.querySelectorAll('form input[type="radio"]').forEach(e=>{e.addEventListener("input",e=>{const s=e.currentTarget.closest("li").querySelector(".input-field");s?(s.value.length>0?t.forEach(e=>{e.removeAttribute("disabled")}):t.forEach(e=>{e.setAttribute("disabled",!0)}),s.addEventListener("input",e=>{e.currentTarget.value.length>0?t.forEach(e=>{e.removeAttribute("disabled")}):t.forEach(e=>{e.setAttribute("disabled",!0)})})):t.forEach(e=>{e.removeAttribute("disabled")})},{signal:c.signal,passive:!0})})},onClose(e,t){e.querySelector("form").reset(),c.abort(),s.destroy(),t.forEach(e=>{e.querySelector(".button-text").textContent=e.dataset.label,e.querySelector(".spinner").classList.remove("is-active"),e.setAttribute("disabled",!0)})},onSubmit(s,n){n.forEach(e=>{e.querySelector(".button-text").textContent=e.dataset.processing,e.querySelector(".spinner").classList.add("is-active"),e.setAttribute("disabled",!0)});const i=s.querySelector("form input:checked"),o=i.value,c=i?.closest("li").querySelector(".input-field")?.value,a={reason_type:o,reason_value:null!=c?c:""};t.ajax.post(E,{_ajax_nonce:r,data:a}).always(function(){s.close(),e.location.replace(l)})}})})}};e.StorePress=e.StorePress||{},e.StorePress.AdminPluginDeactivationFeedback=n.Init}(window,wp)})()})();